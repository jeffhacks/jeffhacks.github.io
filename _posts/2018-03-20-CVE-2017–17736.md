---
layout: post
title:  "Access Control Bypass in Kentico CMS (CVE-2017â€“17736)"
date:   2018-03-20 12:00:00 +1000
categories: advisories
---

Kentico 9.0 before 9.0.51 and 10.0 before 10.0.48 allows remote attackers to obtain Global Administrator access by visiting CMSInstall/install.aspx and then navigating to the CMS Administration Dashboard.

<!--more-->

## Access Control Bypass in Kentico CMS
- Affected Vendor: Kentico - https://www.kentico.com
- Affected Software: Kentico CMS
- Affected Version: Tested on 8.0, 9.0 and 10.0. Earlier versions may also be affected.
- Issue type: Insufficient Access Control
- Release Date: 23 March 2018
- Discovered by: Jeff Thomas, Hivint
- CVE Identifier: CVE-2017-17736
- Issue status: Coordinated disclosure

## Summary
Kentico  CMS is a popular ASP.NET Content Management System (CMS) commonly used  for building web-based sites and online stores, with multisite and  E-commerce functionality.

#### Description
-----------
Kentico  CMS is vulnerable to an access control bypass as it fails to properly  restrict access the installation wizard. It is possible for an  unauthenticated user to gain access to these pages and perform actions  such as installing a new starter site or obtaining access to the "New  site wizard", which automatically authenticates as the Global  Administrator.

#### Impact
------
An  unauthenticated attacker may leverage this issue to gain Global  Administrator access to a Kentico installation. From there it is  possible to perform administrative actions, install news sites or  potentially obtain remote code execution.

### Proof of concept
----------------
1. Request `https://<hostname>/CMSInstall/install.aspx` using a POST request. This can be achieved using freely available tools or by using the HTML below:

```
<html>
 <body>
  <form action="https://HOSTNAME/CMSInstall/install.aspx" method="POST">
  <!-- __CMSCsrfToken is required for Kentico 10.0. A valid token  can be obtained from another page such as "/Special-pages/Sign-in".  -->
  <input name="__CMSCsrfToken" id="__CMSCsrfToken" value="VALIDCSRFTOKEN" type="hidden">
  <input type="submit" value="Submit request" />
 </form>
</body>
</html>
```
Note:  Version 10 may detect this as a CSRF attack. This can be bypassed by  leveraging a CSRF token provisioned elsewhere, such as the Sign In page.

2. Select "Use an existing database" and enter an  arbitrary database name that does not exist. Uncheck "Create Kentico  database objects" and click "Next".
3. Select "Continue  to the New site wizard" (or "Create a new site or import an existing  Kentico site" for Kentico 10) and click "Next".
(Note: It is also possible to use the "Choose starter site" option and install additional sites)
4.  Observe the "New site wizard" and authentication as the Global  Administrator. Click the home icon to go to the CMS Administration  Dashboard.

## Solution
An immediate  fix, Kentico has recommended to restrict access to the  `~/CMSInstall/install.aspx` page by adding the following `<security>`  element in your web.config's `<system.webServer>` section:
```
<!--Restrict access to ~/CMSInstall/install.aspx -->
<security>
 <requestFiltering>
  <denyUrlSequences>
   <add sequence="/CMSInstall/install.aspx" />
  </denyUrlSequences>
 </requestFiltering>
</security>
```
The vendor has also released a hotfix for Kentico 9 and Kentico 10:
- http://www.kentico.com/Downloads/HotFix/9_0/Hotfix_9_0_51.exe
- http://www.kentico.com/Downloads/HotFix/10_0/Hotfix_10_0_48.exe

In  addition to regularly patching a CMS, it is advisable to remove or  restrict access to initial installation directories and other default  configuration pages where possible.

## Response timeline
- 11/12/2017 - Vendor notified.
- 15/12/2017 - Patch available for 9.0 (Hotfix 9.0.51)
- 15/12/2017 - Patch available for 10.0 (Hotfix 10.0.48)
- 20/03/2018 - Advisory released.